/*
 * SPDX-License-Identifier: BSD-3-Clause
 * SPDX-FileCopyrightText: Copyright The TrustedFirmware-M Contributors
 */

#ifndef __RSE_SAM_CONFIG_H__
#define __RSE_SAM_CONFIG_H__

#include "sam_drv.h"

#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>

#ifdef __cplusplus
extern "C" {
#endif

enum rse_sam_event_id_t {
    RSE_SAM_EVENT_LCM_FATAL_ERROR = SAM_EVENT_USECASE_SPECIFIC_START,
    RSE_SAM_EVENT_CPU_LOCKUP,
    RSE_SAM_EVENT_ATU_ERROR,
    RSE_SAM_EVENT_KMU_PARITY_ERROR,
    RSE_SAM_EVENT_CRYPTO_PARITY_ERROR,
    RSE_SAM_EVENT_SIC_PARITY_ERROR,
    RSE_SAM_EVENT_AES_DFA_ERROR,
    RSE_SAM_EVENT_AES_PARITY_ERROR,
    RSE_SAM_EVENT_DMA_DCLS_ERROR,
    RSE_SAM_EVENT_PSI_PARITY_ERROR,
    RSE_SAM_EVENT_BUS_PARITY_ERROR,
    RSE_SAM_EVENT_PROCESSOR_DCLS_ERROR,
    RSE_SAM_EVENT_PROCESSOR_RAS_SET_0,
    RSE_SAM_EVENT_PROCESSOR_RAS_SET_1,
    RSE_SAM_EVENT_PROCESSOR_RAS_SET_2,
    RSE_SAM_EVENT_SRAM_PARTIAL_WRITE,
    RSE_SAM_EVENT_VM0_SINGLE_ECC_ERROR,
    RSE_SAM_EVENT_VM1_SINGLE_ECC_ERROR,
    RSE_SAM_EVENT_VM2_SINGLE_ECC_ERROR,
    RSE_SAM_EVENT_VM3_SINGLE_ECC_ERROR,
    RSE_SAM_EVENT_VM0_DOUBLE_ECC_ERROR,
    RSE_SAM_EVENT_VM1_DOUBLE_ECC_ERROR,
    RSE_SAM_EVENT_VM2_DOUBLE_ECC_ERROR,
    RSE_SAM_EVENT_VM3_DOUBLE_ECC_ERROR,
    RSE_SAM_EVENT_SRAM_MPC_PARITY_ERROR,
    RSE_SAM_EVENT_SIC_MPC_PARITY_ERROR,
    RSE_SAM_EVENT_ATU_PARITY_ERROR,
    RSE_SAM_EVENT_PPR_PARITY_ERROR,
    RSE_SAM_EVENT_SYSCTRL_PARITY_ERROR,
    RSE_SAM_EVENT_CPU_PPB_PARITY_ERROR,
    RSE_SAM_EVENT_SACFG_PARITY_ERROR,
    RSE_SAM_EVENT_NSACFG_PARITY_ERROR,
    RSE_SAM_EVENT_INTEGRITY_CHECKER_ALARM,
    RSE_SAM_EVENT_TRAM_PARITY_ERROR,
    /* Reserved 37-47 */
    RSE_SAM_EVENT_EXTERNAL_SENSOR_0 = 48UL,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_1,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_2,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_3,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_4,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_5,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_6,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_7,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_8,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_9,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_10,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_11,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_12,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_13,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_14,
    RSE_SAM_EVENT_EXTERNAL_SENSOR_15,

    RSE_SAM_EVENT_COUNT = 64
};

void sam_handle_fast_attack_counter_increment(void);

/**
 * @brief Select how SAM init should run.
 *
 * - RSE_SAM_INIT_SETUP_HANDLERS_ONLY:
 *     Skip SAM response configuration in the SE LCS state because ADA DMA
 *     provisions SAM responses during secure provisioning.
 *     Also prefer this in stages beyond BL1, since SAM responses only
 *     need to be set once.
 *
 * - RSE_SAM_INIT_SETUP_FULL:
 *     Configure SAM responses and send a manual DMA ACK for trigger 4.
 *     Required in non-SE LCS states (e.g., CM or DM). In SE, ADA DMA is
 *     expected to provision SAM and handle the ACK sequence correctly.
 */
enum rse_sam_init_setup_t {
    RSE_SAM_INIT_SETUP_HANDLERS_ONLY,
    RSE_SAM_INIT_SETUP_FULL,
};

uint32_t rse_sam_init(enum rse_sam_init_setup_t setup);
void rse_sam_finish(void);

#ifdef __cplusplus
}
#endif

#endif /* __RSE_SAM_CONFIG_H__ */
